---
title: "health_graphing"
output: html_notebook
---

##Graphing the health data

Loading libraries
```{r libraries, message = FALSE}
library(showtext)
library(classInt)
library(ggthemes)
library(reshape2)
library(tidyverse)
```

Reading in data
```{r data, message = FALSE}
setwd("C:/Users/natek/Documents/Github/glp_website/data")
health_values = read_csv("health data values.csv")
health_z = read_csv("health data z_scores.csv")
```

The code for the rankings graphs
```{r rankings}
rank_and_nb_group<-function(df, var, order="Descending", peers="Current",
                            plot_title="", y_title = "Percent", caption_text = ""){
  df$var <- df[[var]]
  if(peers=="Current"){
    df<-subset(df,current_peer ==1)
  }
  if(peers=="Baseline"){
    df<-subset(df,baseline_peer ==1)
  }
  if(order=="Descending"){
    d.order<-df[order(-df$var),]
  }
  if(order=="Ascending"){
    d.order<-df[order(df$var),]
  }
  ranks<-1:length(df$var)
  d.rank<-cbind(d.order,ranks)
  names<-paste(d.rank$ranks,".",sep="")
  names<-paste(names,d.rank$city)
  d.graph<-cbind(d.rank,names)
  
  breaks<-classIntervals(d.graph$var,3,style="jenks")
  d.graph$color<-NA
  d.graph$color[d.graph$var<=breaks$brks[2]]<-"green"
  d.graph$color[d.graph$var>breaks$brks[2] & d.graph$var<=breaks$brks[3]]<-"yellow"
  d.graph$color[d.graph$var>breaks$brks[3]]<-"red"
  d.graph$round<-format(round(d.graph$var,1),nsmall=1)
  d.graph$textfont<-"Museo Sans 300"
  d.graph$textfont[d.graph$city == "Louisville"]<-"Museo Sans Italic"
  d.graph$linecolor<-"white"
  d.graph$linecolor[d.graph$city == "Louisville"]<-"#00a9b7"
  d.graph$textcolor<-"black"
  d.graph$textcolor[d.graph$city == "Louisville"]<-"#00a9b7"
  
  
  p<-ggplot(data=d.graph,aes(x=factor(names, levels=rev(unique(names))),
                             y=var,fill=factor(color)))+guides(fill=FALSE)
  p<-p+geom_bar(stat="identity",color=rev(d.graph$linecolor), size = 1)+coord_flip()+theme_tufte()
  if(order=="Ascending"){
    p<-p+scale_fill_manual(values=c("#96ca4f","#db2834","#ffd600"))
  }
  if(order=="Descending"){
    p<-p+scale_fill_manual(values=c("#db2834","#96ca4f","#ffd600"))
  }
  p <- p + theme(text = element_text(family = "Museo Sans 300"),
                plot.title = element_text(size = 18, hjust = 0.5),
                axis.text.y=element_text(hjust=0, family = rev(d.graph$textfont),
                                         size=12, color = rev(d.graph$textcolor)),
                axis.ticks=element_blank(),
                axis.text.x = element_blank(),
                plot.caption = element_text(),
                plot.subtitle = element_text(hjust = 0.5))
  p <- p+geom_text(aes(label=round),hjust=1.1, size=5, family = "Museo Sans 300")
  p<-p+labs(title = plot_title, y= y_title,
            x = "", caption = caption_text)
  p
}

```

Adding fonts
```{r}
font.add("Museo Sans 300", "C:/Users/natek/Documents/fonts/MuseoSans/MuseoSans_300.otf")
font.add("Museo Sans Italic", "C:/Users/natek/Documents/fonts/MuseoSans/MuseoSans_300_Italic.otf")

```


```{r, message = FALSE}
setwd("C:/Users/natek/Documents/images")

jpeg("health_outcomes_premature_death.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "premature_death", order = "Ascending",
                  plot_title = "Premature Death", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings ")
showtext.end()
dev.off()

jpeg("health_outcomes_poor_or_fair_health.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "poor_or_fair_health", order = "Ascending",
                  plot_title = "Days of Poor or Fair Health per Month", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_outcomes_poor_physical_health_days.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "poor_physical_health_days", order = "Ascending",
                  plot_title = "Days of Poor Physical Health per Month", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_outcomes_poor_mental_health_days.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "poor_mental_health_days", order = "Ascending",
                  plot_title = "Days of Poor Mental Health per Month", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_outcomes_low_birthweight.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "low_birthweight", order = "Ascending",
                  plot_title = "Low Birthweight", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_adult_smoking.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "adult_smoking", order = "Ascending",
                  plot_title = "Smoking", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_adult_obesity.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "adult_obesity", order = "Ascending",
                  plot_title = "Adult Obesity", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_food_environment_index.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "food_environment_index", order = "Ascending",
                  plot_title = "Food Environment Index", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_physical_inactivity.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "physical_inactivity", order = "Ascending",
                  plot_title = "Physical Inactivity", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_access_to_exercise_opportunities.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "access_to_exercise_opportunities", order = "Ascending",
                  plot_title = "Access to Exercise Opportunities", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_excessive_drinking.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "excessive_drinking", order = "Ascending",
                  plot_title = "Excessive Drinking", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_alcohol_impaired_driving_deaths.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "alcohol_impaired_driving_deaths", order = "Ascending",
                  plot_title = "Alcohol Impaired Driving Deaths", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_sexually_transmitted_infections.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "sexually_transmitted_infections", order = "Ascending",
                  plot_title = "Sexually Transmitted Infections", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_behaviors_teen_births.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "teen_births", order = "Ascending",
                  plot_title = "Teen Births", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_cc_uninsured.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "uninsured", order = "Ascending",
                  plot_title = "Uninsured", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_cc_primary_care_physicians.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "primary_care_physicians", order = "Ascending",
                  plot_title = "Primary Care Physicians", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_cc_dentists.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "dentists", order = "Ascending",
                  plot_title = "Dentists", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_cc_mental_health_providers.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "mental_health_providers", order = "Ascending",
                  plot_title = "Mental Health Providers", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_cc_preventable_hospital_stays.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "preventable_hospital_stays", order = "Ascending",
                  plot_title = "Preventable Hospital Stays", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_cc_diabetes_monitoring.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "diabetes_monitoring", order = "Ascending",
                  plot_title = "Diabetes Monitoring", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_cc_mammography_screening.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "mammography_screening", order = "Ascending",
                  plot_title = "Mammography Screening", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_sec_social_associations.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "social_associations", order = "Ascending",
                  plot_title = "Social Associations", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_sec_violent_crime.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "violent_crime", order = "Ascending",
                  plot_title = "Violent Crime", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_sec_injury_deaths.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "injury_deaths", order = "Ascending",
                  plot_title = "Injury Deaths", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_pe_air_pollution.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "air_pollution", order = "Ascending",
                  plot_title = "Air Pollution", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

# jpeg("health_pe_drinking_water.jpg", 900, 600, res = 100)
# showtext.begin()
# rank_and_nb_group(health_values, "drinking_water", order = "Ascending",
#                   plot_title = "Drinking Water", 
#                   caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
# showtext.end()
# dev.off()

jpeg("health_pe_severe_housing_problems.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "severe_housing_problems", order = "Ascending",
                  plot_title = "Severe Housing Problems", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_pe_severe_housing_problems.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "severe_housing_problems", order = "Ascending",
                  plot_title = "Severe Housing Problems", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_pe_driving_alone_to_work.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "driving_alone_to_work", order = "Ascending",
                  plot_title = "Driving Alone to Work", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()

jpeg("health_pe_long_commute.jpg", 900, 600, res = 100)
showtext.begin()
rank_and_nb_group(health_values, "long_commute", order = "Ascending",
                  plot_title = "Long Commute", 
                  caption_text = "Source: Greater Louisville Project \nData from the Robert Wood Johnson Foundation 2017 County Health Rankings")
showtext.end()
dev.off()




```

